import{__assign as e}from"tslib";import{parse as t}from"espree";import n from"path";import r from"remark-mdx";import s from"remark-parse";import i from"unified";var o=["@typescript-eslint/parser","babel-eslint"],a=["JSXElement","JSXFragment"],u=function(e){return a.includes(e.type)},c=function(e){if(e){if("string"==typeof e&&(e=require(e)),"object"==typeof e&&(e="parseForESLint"in e&&e.parseForESLint||"parse"in e&&e.parse),"function"!=typeof e)throw new TypeError("Invalid custom parser for `eslint-mdx`: "+e);return[e]}for(var n=[t],r=0,s=o;r<s.length;r++){var i=s[r];try{var a=require(i),u="parseForESLint"in a?a.parseForESLint:a.parse;u&&n.unshift(u)}catch(e){}}return n},l=function(t){var n=t.start.offset,r=t.end.offset;return{range:[n,r],loc:e({},t),start:n,end:r}};function p(t,n,r){if(!t||!t.loc||!t.range)return t;Object.entries(t).forEach((function(e){var s=e[0],i=e[1];i&&(Array.isArray(i)?t[s]=i.map((function(e){return p(e,n,r)})):t[s]=p(i,n,r))}));var s=t.loc,i=s.start,o=s.end,a=t.range,u=a[0]+r,c=a[1]+r;return e(e({},t),{start:u,end:c,range:[u,c],loc:{start:{line:n+i.line,column:i.column},end:{line:n+o.line,column:o.column}}})}var f=function(e){return e&&e[0]},m=function(e){return e&&e[e.length-1]},h=function(e,t){return t.every((function(t){return t in e}))},d="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*"+("(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"|"+"{.*}".replace(".","[\0-ï¿¿]")+")")+")?)",v="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+d+"*\\s*>",x="<\\s*\\/[A-Za-z]*[A-Za-z0-9\\.\\-]*\\s*>",y="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+d+"*\\s*\\/?>",g="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e",_="(\x3c!---*)",E="(-*--\x3e)",b=new RegExp("^(?:"+v+")$"),S=new RegExp("^(?:"+x+")$"),w=new RegExp("^(?:"+v+"[\\s\\S]*"+x+")$"),J=new RegExp("^(?:"+y+")$"),N=new RegExp("^(?:"+g+")$"),A=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)","g"),L=function(e){return b.test(e)},j=function(e){return S.test(e)},z=function(e){return N.test(e)},T=function(e){return w.test(e)},F=function(e){return J.test(e)},k=function(){function e(e){var t=e.code,n=e.enter;this.code=t,this._enter=n}return e.prototype.combineLeftJsxNodes=function(e){var t=e[0].position.start,n=m(e).position.end;return{type:"jsx",data:e[0].data,value:this.code.slice(t.offset,n.offset),position:{start:e[0].position.start,end:m(e).position.end}}},e.prototype.combineJsxNodes=function(e,t){var n=this,r=0,s=[],i=e.length;return e.reduce((function(e,o,a){if("jsx"===o.type){var u=o.value;if(L(u))r++,s.push(o);else{if(j(u))r--,s.push(o);else if(z(u)||F(u)||T(u))s.push(o);else try{var c=q.normalizeJsxNode(o,t);s.push.apply(s,Array.isArray(c)?c:[c])}catch(e){var l=o.position.start;throw Object.assign(new SyntaxError("unknown jsx node: "+JSON.stringify(u)),{lineNumber:l.line,column:l.column,index:l.offset})}if(!r){var p=s.findIndex((function(e){return L(e.value)}));-1===p?e.push.apply(e,s):(e.push.apply(e,s.slice(0,p)),e.push(n.combineLeftJsxNodes(s.slice(p)))),s.length=0}}}else r?s.push(o):e.push(o);return a===i-1&&s.length>0&&e.push(n.combineLeftJsxNodes(s)),e}),[])},e.prototype.traverse=function(e,t){var n=this;if(e){var r=e.children;if(r){var s=e;(r=e.children=this.combineJsxNodes(r,s)).forEach((function(e){return n.traverse(e,s)}))}this._enter(e,t)}},e}(),P=function(e,t){return new k(t).traverse(e)},Z=i().use(s).use(r).freeze(),$=["body","comments","tokens"],R=["export","import","jsx"],X=["column","lineNumber"],C=[".mdx"],O=[".md"],H={comment:!0,ecmaFeatures:{jsx:!0},ecmaVersion:(new Date).getUTCFullYear(),sourceType:"module",tokens:!0,filePath:"__placeholder__.mdx",loc:!0,range:!0},M="<$>".length,W=function(){function t(){this._options=H,this.parse=this.parse.bind(this),this.parseForESLint=this.parseForESLint.bind(this)}return t.prototype.normalizeJsxNode=function(t,n,r){void 0===r&&(r=this._options);var s=t.value;if("jsx"!==t.type||z(s))return t;if(A.exec(s)){var i=[],o=t.position.start,a=o.line,u=o.column,c=o.offset;Object.assign(t,{data:e(e({},t.data),{jsxType:"JSXElementWithHTMLComments",comments:i,inline:!!n&&"root"!==n.type}),value:s.replace(A,(function(e,t,n,r,o){var l=o+e.length,p=s.slice(0,o).split("\n"),f=s.slice(0,l).split("\n"),h="{/"+"*".repeat(t.length-2)+n+"*".repeat(r.length-2)+"/}",d=p.length-1,v=f.length-1;return i.push({fixed:h,loc:{start:{line:a+d,column:m(p).length+(d?0:u-1),offset:c+o},end:{line:a+v,column:m(f).length+(v?0:u-1),offset:c+l}},origin:e}),h}))})}return this._normalizeJsxNodes(t,r)},t.prototype.parse=function(e,t){return this.parseForESLint(e,t).ast},t.prototype.parseForESLint=function(t,r){var s=this,i=n.extname(r.filePath),o=C.concat(r.extensions||[]).includes(i),a=O.concat(r.markdownExtensions||[]).includes(i);if(!o&&!a)return this._eslintParse(t,r);var u=Z.parse(t);return this._ast=e(e({},l(u.position)),{type:"Program",sourceType:r.sourceType||"module",body:[],comments:[],tokens:[]}),this._services={JSXElementsWithHTMLComments:[]},o&&P(u,{code:t,enter:function(e,t){if(R.includes(e.type)){var n=s.normalizeJsxNode(e,t,r);(n=Array.isArray(n)?n:[n]).forEach((function(e){return s._nodeToAst(e,r)}))}}}),{ast:this._ast,services:this._services}},t.prototype._eslintParse=function(e,t){var n,r;this._parsers&&t.parser===this._options.parser||(this._parsers=c(t.parser)),t.filePath&&this._options!==t&&Object.assign(this._options,t);for(var s=0,i=this._parsers;s<i.length;s++){var o=i[s];try{n=o(e,this._options);break}catch(e){r||(r=e)}}if(!n&&r)throw r;return"ast"in n&&n.ast?n:{ast:n}},t.prototype._normalizeJsxNodes=function(e,t){var n,r=e.value;try{n=this._eslintParse("<$>"+r+"</$>",t).ast}catch(t){if(h(t,X)){var s=e.position.start;throw"index"in t?t.index+=s.offset-M:"pos"in t&&(t.pos+=s.offset-M),t.column=t.lineNumber>1?t.column:t.column+s.column-M,t.lineNumber+=s.line-1,t}return e}var i=n.body[0].expression;if(!u(i)||i.children.length<=1)return e;var o=e.position.start,a=o.line,c=o.offset;return i.children.reduce((function(t,n){if(!u(n))return t;var s=n.start,i=n.end,o=n.loc,l=void 0===o?{start:{column:s,line:1},end:{column:i,line:1}}:o,p=l.start,f=l.end,m=n.range,h=void 0===m?[s,i]:m,d=a+p.line-1,v=a+f.line-1,x=h[0]-M,y=h[1]-M;return t.push({type:"jsx",data:t.length>0?null:e.data,value:r.slice(x,y),position:{start:{line:d,column:a===d?p.column-M:p.column,offset:c+x},end:{line:v,column:a===d?f.column-M:f.column,offset:c+y}}}),t}),[])},t.prototype._nodeToAst=function(e,t){var n=this;e.data&&"JSXElementWithHTMLComments"===e.data.jsxType&&this._services.JSXElementsWithHTMLComments.push(e);var r=e.value;if(!z(r)){var s,i=l(e.position),o=i.loc,a=i.start,u=o.start.line-1;try{s=this._eslintParse(r,t).ast}catch(e){throw h(e,X)&&(e.index+=a,e.column=e.lineNumber>1?e.column:e.column+o.start.column,e.lineNumber+=u),e}var c=a-s.range[0];$.forEach((function(e){var t;return(t=n._ast[e]).push.apply(t,s[e].map((function(e){return p(e,u,c)})))}))}},t}(),q=new W,I=q.parse,D=q.parseForESLint;export{$ as AST_PROPS,S as CLOSE_TAG_REGEX,A as COMMENT_CONTENT_REGEX,N as COMMENT_REGEX,C as DEFAULT_EXTENSIONS,H as DEFAULT_PARSER_OPTIONS,R as ES_NODE_TYPES,o as FALLBACK_PARSERS,a as JSX_TYPES,X as LOC_ERROR_PROPERTIES,O as MARKDOWN_EXTENSIONS,w as OPEN_CLOSE_TAG_REGEX,b as OPEN_TAG_REGEX,W as Parser,J as SELF_CLOSING_TAG_REGEX,k as Traverse,x as closeTag,g as comment,E as commentClose,_ as commentOpen,f as first,h as hasProperties,j as isCloseTag,z as isComment,u as isJsxNode,T as isOpenCloseTag,L as isOpenTag,F as isSelfClosingTag,m as last,Z as mdxProcessor,c as normalizeParser,l as normalizePosition,v as openTag,I as parse,D as parseForESLint,q as parser,p as restoreNodeLocation,y as selfClosingTag,P as traverse};
